# 对称加密和非对称加密

### 别名  
对称加密又叫：单钥加密、私钥加密
非对称加密又叫：双钥加密、公钥加密

### 密钥  
密钥是一种参数，它是在明文转换为密文或将密文转换为明文的算法中输入的参数。密钥分为对称密钥与非对称密钥，分别应用在对称加密和非对称加密上。

### 对称加密
对称加密是指加密和解密使用相同密钥的加密算法。对称加密中用到的密钥叫做私钥。

对称加密的特点是算法公开、计算量小、加密和解密速度快、加密效率高。

常见的对称加密算法有DES、3DES、TDEA、Blowfish、RC5和IDEA。   

加密过程如下：明文 + 加密算法 + 私钥 => 密文；  
解密过程如下：密文 + 解密算法 + 私钥 => 明文   

### 非对称加密
非对称加密使用一对密钥，即公钥和私钥，且二者成对出现。用公钥或私钥中的任何一个进行加密，用另一个进行解密。

特点：  
非对称加密与对称加密相比，其安全性更好。  
非对称加密的缺点是加密和解密花费时间长、速度慢，只适合对少量数据进行加密。 
   
被公钥加密过的密文只能被私钥解密，过程如下：   
明文 + 加密算法 + 公钥 => 密文， 密文 + 解密算法 + 私钥 => 明文 
  
被私钥加密过的密文只能被公钥解密，过程如下：   
明文 + 加密算法 + 私钥 => 密文， 密文 + 解密算法 + 公钥 => 明文 
    
在非对称加密中使用的主要算法有：RSA、Elgamal、Rabin、D-H、ECC（椭圆曲线加密算法）等。

# HTTPS
HTTPS = HTTP + SSL/TLS

HTTPS = 对称加密算法加密数据 + 非对称加密算法交换密钥 + 数字证书验证身份

基本流程可分为三步：

- 1. 客户端向服务器端索要并验证公钥。
- 2. 双方协商生成"对话密钥"。
- 3. 双方采用"对话密钥"进行加密通信。

前两步又称为“握手（handshake）”。

握手阶段又可分为5步：

#### 第一步. 客户端发出请求(ClientHello)
客户端通过发送ClinetHello报文开始SSL通信。    
该报文提供以下信息：

  - 支持的版本协议列表，如TLS 1.0
  - 一个客户端生成的随机数（Client random）
  - 客户端支持的加密算法，如RSA

#### 第二步. 服务器回应(ServerHello)
服务器收到客户端请求后，如果服务器可以进行SSL通信，会向客户端发出SeverHello报文作为应答。  
该报文包含如下内容：

  - 确认使用的加密通信协议版本，从客户端发送过来的列表中筛选出来的。
  - 确认使用的加密方法，比如RSA。
  - 一个服务器生成的随机数（Server random）
  - 服务器的数字证书

如果服务器需要确认客户端的身份，则会再包含一项请求，要求客户端提供"客户端证书"。比如，金融机构往往只允许认证客户连入自己的网络，就会向正式客户提供USB密钥，里面就包含了一张客户端证书。

### 第三步. 客户端回应
客户端收到服务器回应以后，首先验证服务器证书。

如果证书不是可信机构颁布、或者证书中的域名与实际域名不一致、或者证书已经过期，就会向访问者显示一个警告，由其选择是否还要继续通信。

如果证书没有问题，客户端就会从证书中取出服务器的公钥。然后，向服务器发送一个新的随机数（Pre-master secret），该随机数用服务器公钥加密。

客户端还会发送一个连接至今全部报文所有内容的hash值，用来给服务器校验。

如果前一步服务器要求客户端证书，客户端会在这一步发送证书及相关信息。

#### 第四步. 服务器回应
服务器收到客户端的第三个随机数pre-master key之后，计算生成本次会话所用的"会话密钥"(session key)。然后，向客户端最后发送一些信息，包括双方商定的加密协议，加密方法，以及前面发送所有内容的hash值，用来给客户端校验。


整个握手阶段结束后，加密通信算是建立完成，后面就是普通的HTTP请求了，只不过用"会话密钥"加密内容。

![](http://image.beekka.com/blog/2014/bg2014092003.png)


### 为什么要用三个随机数
上面的整个握手阶段一共出现了三个随机数。

> 因为要保证会话密钥不会每次都一样。由于SSL协议中证书是静态的（公钥是静态的），而pre-master_secret本身其实是一个伪随机数（真正意义上的随机数是不存在的）。所以这时候需要引进client hello和server hello里面的random值再加上pre-master_secret，三个随机数通过一个密钥导出器最终导出一个对称密钥，一个伪随机可能完全不随机，可是是三个伪随机就十分接近随机了。


### 参考
[SSL/TLS协议运行机制的概述](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)

[图解SSL/TLS协议](http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html)